<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Test and improve your numeric typing speed with this professional typing test tool"
    />
    <title>Numeric Typing Speed Test | Improve Your Number Typing Skills</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #3b82f6;
        --primary-dark: #2563eb;
        --primary-light: #93c5fd;
        --success: #10b981;
        --error: #ef4444;
        --warning: #f59e0b;
        --bg-dark: #0f172a;
        --bg-darker: #020617;
        --text-light: #f8fafc;
        --text-muted: #94a3b8;
        --card-bg: rgba(15, 23, 42, 0.7);
        --border-radius: 12px;
        --transition: all 0.2s ease;
      }

      /* === RESET === */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html {
        font-size: 16px;
        scroll-behavior: smooth;
      }

      body {
        font-family: "Inter", system-ui, -apple-system, sans-serif;
        line-height: 1.6;
        color: var(--text-light);
        background: linear-gradient(135deg, var(--bg-darker), var(--bg-dark));
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* === TYPOGRAPHY === */
      h1,
      h2,
      h3 {
        font-weight: 700;
        line-height: 1.2;
      }

      h1 {
        font-size: 2.5rem;
        background: linear-gradient(
          90deg,
          var(--primary),
          var(--primary-light)
        );
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        margin-bottom: 1rem;
      }

      h2 {
        font-size: 1.75rem;
        margin-bottom: 1.5rem;
      }

      p {
        margin-bottom: 1rem;
      }

      /* === LAYOUT === */
      .container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1.5rem;
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      header {
        text-align: center;
        margin-bottom: 2rem;
        width: 100%;
      }

      .subtitle {
        color: var(--text-muted);
        font-size: 1.1rem;
        max-width: 600px;
        margin: 0 auto;
      }

      /* === CONTROL PANEL === */
      .control-panel {
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        border-radius: var(--border-radius);
        padding: 1.5rem;
        width: 100%;
        max-width: 800px;
        margin-bottom: 2rem;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }

      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        justify-content: center;
        align-items: center;
      }

      .control-group {
        display: flex;
        flex-direction: column;
        min-width: 120px;
      }

      label {
        font-size: 0.9rem;
        font-weight: 500;
        color: var(--text-muted);
        margin-bottom: 0.5rem;
      }

      input[type="number"],
      select {
        background: rgba(30, 41, 59, 0.5);
        color: var(--text-light);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 0.75rem 1rem;
        font-size: 1rem;
        font-family: inherit;
        transition: var(--transition);
      }

      input[type="number"]:focus,
      select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
      }

      /* === BUTTONS === */
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        font-size: 1rem;
        padding: 0.75rem 1.5rem;
        cursor: pointer;
        transition: var(--transition);
        user-select: none;
        white-space: nowrap;
        gap: 0.5rem;
      }

      .btn:hover:not(:disabled),
      .btn:focus-visible:not(:disabled) {
        background: var(--primary-dark);
        transform: translateY(-1px);
      }

      .btn:active:not(:disabled) {
        transform: translateY(0);
      }

      .btn:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        background: #64748b;
      }

      .btn-secondary {
        background: rgba(30, 41, 59, 0.7);
      }

      .btn-secondary:hover:not(:disabled) {
        background: rgba(30, 41, 59, 0.9);
      }

      .btn-icon {
        padding: 0.75rem;
      }

      /* === TEXT DISPLAY === */
      .text-display-container {
        width: 100%;
        max-width: 800px;
        margin-bottom: 2rem;
      }

      .text-display {
        width: 100%;
        font-size: 1.5rem;
        line-height: 2.5rem;
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        padding: 2rem;
        border-radius: var(--border-radius);
        margin-bottom: 1rem;
        user-select: none;
        min-height: 180px;
        letter-spacing: 1px;
        font-feature-settings: "tnum";
        font-variant-numeric: tabular-nums;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      .char {
        padding: 0.125rem 0.25rem;
        border-radius: 4px;
        transition: var(--transition);
        position: relative;
      }

      .char.current {
        background: rgba(59, 130, 246, 0.2);
        box-shadow: 0 0 0 1px var(--primary);
      }

      .char.current::after {
        content: "";
        position: absolute;
        bottom: -5px;
        left: 50%;
        transform: translateX(-50%);
        width: 8px;
        height: 8px;
        background: var(--primary);
        border-radius: 50%;
      }

      .char.correct {
        color: var(--success);
      }

      .char.wrong {
        color: var(--error);
        text-decoration: underline;
      }

      /* === STATS === */
      .stats-container {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        justify-content: center;
        width: 100%;
        max-width: 800px;
        margin-bottom: 2rem;
      }

      .stat-card {
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        border-radius: var(--border-radius);
        padding: 1.25rem;
        min-width: 140px;
        text-align: center;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.05);
        transition: var(--transition);
      }

      .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }

      .stat-value {
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
        color: var(--primary);
      }

      .stat-label {
        font-size: 0.9rem;
        color: var(--text-muted);
        font-weight: 500;
      }

      /* === PROGRESS BAR === */
      .progress-container {
        width: 100%;
        max-width: 800px;
        margin-bottom: 2rem;
      }

      .progress-bar {
        height: 10px;
        width: 100%;
        background: rgba(30, 41, 59, 0.7);
        border-radius: 5px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        width: 0%;
        background: linear-gradient(
          90deg,
          var(--primary),
          var(--primary-light)
        );
        transition: width 0.3s ease;
        position: relative;
      }

      .progress-fill::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0) 0%,
          rgba(255, 255, 255, 0.2) 50%,
          rgba(255, 255, 255, 0) 100%
        );
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }

      .progress-labels {
        display: flex;
        justify-content: space-between;
        margin-top: 0.5rem;
        font-size: 0.875rem;
        color: var(--text-muted);
      }

      /* === MODAL === */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(2, 6, 23, 0.9);
        backdrop-filter: blur(5px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 100;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .modal-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      .modal {
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        border-radius: var(--border-radius);
        padding: 2.5rem;
        width: 100%;
        max-width: 500px;
        text-align: center;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
        transform: translateY(20px);
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .modal-overlay.active .modal {
        transform: translateY(0);
      }

      .modal-icon {
        font-size: 3rem;
        margin-bottom: 1.5rem;
        color: var(--primary);
      }

      .modal-results {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
        margin: 2rem 0;
      }

      .modal-stat {
        text-align: center;
      }

      .modal-stat-value {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 0.25rem;
      }

      .modal-stat-label {
        font-size: 0.9rem;
        color: var(--text-muted);
      }

      /* === FOOTER === */
      footer {
        text-align: center;
        padding: 1.5rem;
        color: var(--text-muted);
        font-size: 0.875rem;
        width: 100%;
      }

      footer a {
        color: var(--primary-light);
        text-decoration: none;
        transition: var(--transition);
      }

      footer a:hover {
        color: var(--primary);
      }

      /* === ANIMATIONS === */
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .pulse {
        animation: pulse 1.5s infinite;
      }

      /* === TOAST === */
      .toast {
        position: fixed;
        bottom: 2rem;
        left: 50%;
        transform: translateX(-50%);
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: var(--border-radius);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .toast.show {
        opacity: 1;
        visibility: visible;
        transform: translateX(-50%) translateY(0);
      }

      .toast.hide {
        opacity: 0;
        visibility: hidden;
        transform: translateX(-50%) translateY(20px);
      }

      .toast-icon {
        font-size: 1.25rem;
      }

      .toast-success .toast-icon {
        color: var(--success);
      }

      .toast-error .toast-icon {
        color: var(--error);
      }

      /* === RESPONSIVE === */
      @media (max-width: 768px) {
        h1 {
          font-size: 2rem;
        }

        .subtitle {
          font-size: 1rem;
        }

        .text-display {
          font-size: 1.25rem;
          line-height: 2rem;
          padding: 1.5rem;
          min-height: 150px;
        }

        .stat-card {
          min-width: calc(50% - 0.5rem);
        }

        .modal-results {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 480px) {
        h1 {
          font-size: 1.75rem;
        }

        .container {
          padding: 1.5rem 1rem;
        }

        .control-panel {
          padding: 1rem;
        }

        .controls {
          gap: 0.75rem;
        }

        .btn {
          padding: 0.75rem 1rem;
          font-size: 0.875rem;
        }

        .text-display {
          font-size: 1.1rem;
          line-height: 1.75rem;
          padding: 1rem;
          min-height: 120px;
        }

        .stat-card {
          min-width: 100%;
        }

        .modal {
          padding: 1.5rem;
        }
      }

      /* === THEME TOGGLE === */
      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 100;
        transition: var(--transition);
      }

      .theme-toggle:hover {
        background: rgba(30, 41, 59, 0.7);
      }

      .theme-toggle svg {
        width: 20px;
        height: 20px;
        color: var(--text-light);
      }

      /* Light theme */
      @media (prefers-color-scheme: light) {
        :root {
          --primary: #2563eb;
          --primary-dark: #1d4ed8;
          --primary-light: #3b82f6;
          --success: #059669;
          --error: #dc2626;
          --warning: #d97706;
          --bg-dark: #f8fafc;
          --bg-darker: #f1f5f9;
          --text-light: #0f172a;
          --text-muted: #64748b;
          --card-bg: rgba(255, 255, 255, 0.9);
        }

        body {
          background: linear-gradient(135deg, var(--bg-darker), var(--bg-dark));
        }

        .text-display,
        .control-panel,
        .stat-card,
        .modal {
          box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
            0 2px 4px -1px rgba(0, 0, 0, 0.06);
          border: 1px solid rgba(0, 0, 0, 0.1);
        }

        input[type="number"],
        select {
          background: rgba(241, 245, 249, 0.7);
          color: var(--text-light);
          border: 1px solid rgba(0, 0, 0, 0.1);
        }
      }
    </style>
  </head>
  <body>
    <div class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
        />
      </svg>
    </div>

    <div class="container">
      <header>
        <h1>Numeric Typing Master</h1>
        <p class="subtitle">
          Test and improve your numeric typing speed with different difficulty
          levels and time challenges
        </p>
      </header>

      <div class="control-panel">
        <div class="controls">
          <div class="control-group">
            <label for="timeInput">Test Duration</label>
            <input
              type="number"
              id="timeInput"
              min="15"
              max="600"
              value="60"
              aria-label="Test duration in seconds"
            />
          </div>

          <div class="control-group">
            <label for="difficultySelect">Difficulty</label>
            <select id="difficultySelect" aria-label="Select difficulty level">
              <option value="4">Beginner (4-6 digits)</option>
              <option value="6" selected>Intermediate (6-8 digits)</option>
              <option value="8">Advanced (8-10 digits)</option>
              <option value="12">Expert (10-14 digits)</option>
            </select>
          </div>

          <button id="startBtn" class="btn">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            Start Test
          </button>

          <button id="restartBtn" class="btn btn-secondary" disabled>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M21.5 2v6h-6M21.34 15.57a10 10 0 1 1-.57-8.38" />
            </svg>
            Restart
          </button>

          <button id="zenBtn" class="btn btn-secondary">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            Zen Mode
          </button>
        </div>
      </div>

      <div class="stats-container">
        <div class="stat-card">
          <div class="stat-value" id="timeLeft">60</div>
          <div class="stat-label">Time Left (s)</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="wpm">0</div>
          <div class="stat-label">Words Per Minute</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="cpm">0</div>
          <div class="stat-label">Chars Per Minute</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="accuracy">0</div>
          <div class="stat-label">Accuracy</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="streak">0</div>
          <div class="stat-label">Current Streak</div>
        </div>
      </div>

      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progressBar"></div>
        </div>
        <div class="progress-labels">
          <span>0%</span>
          <span id="progressPercentage">0%</span>
          <span>100%</span>
        </div>
      </div>

      <div class="text-display-container">
        <div
          id="textDisplay"
          class="text-display"
          aria-live="polite"
          aria-label="Numbers to type"
          tabindex="0"
        >
          Press Start Test to begin your numeric typing challenge
        </div>
      </div>
    </div>

    <!-- Results Modal -->
    <div class="modal-overlay" id="resultModal">
      <div class="modal">
        <div class="modal-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="48"
            height="48"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
        </div>
        <h2>Test Completed!</h2>

        <div class="modal-results">
          <div class="modal-stat">
            <div class="modal-stat-value" id="finalWpm">0</div>
            <div class="modal-stat-label">Words Per Minute</div>
          </div>
          <div class="modal-stat">
            <div class="modal-stat-value" id="finalCpm">0</div>
            <div class="modal-stat-label">Chars Per Minute</div>
          </div>
          <div class="modal-stat">
            <div class="modal-stat-value" id="finalAccuracy">0</div>
            <div class="modal-stat-label">Accuracy</div>
          </div>
          <div class="modal-stat">
            <div class="modal-stat-value" id="finalStreak">0</div>
            <div class="modal-stat-label">Max Streak</div>
          </div>
        </div>

        <button id="closeModalBtn" class="btn">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M18 6L6 18M6 6l12 12"></path>
          </svg>
          Close
        </button>
      </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
      <div class="toast-icon"></div>
      <div class="toast-message" id="toastMessage"></div>
    </div>

    <footer>
      <p>
        Made with ❤️ for keyboard enthusiasts |
        <a href="#" id="feedbackLink">Send Feedback</a>
      </p>
    </footer>

    <script>
      (() => {
        // DOM Elements
        const elements = {
          textDisplay: document.getElementById("textDisplay"),
          timeInput: document.getElementById("timeInput"),
          difficultySelect: document.getElementById("difficultySelect"),
          startBtn: document.getElementById("startBtn"),
          restartBtn: document.getElementById("restartBtn"),
          zenBtn: document.getElementById("zenBtn"),
          timeLeftEl: document.getElementById("timeLeft"),
          wpmEl: document.getElementById("wpm"),
          cpmEl: document.getElementById("cpm"),
          accuracyEl: document.getElementById("accuracy"),
          streakEl: document.getElementById("streak"),
          progressBar: document.getElementById("progressBar"),
          progressPercentage: document.getElementById("progressPercentage"),
          resultModal: document.getElementById("resultModal"),
          finalWpm: document.getElementById("finalWpm"),
          finalCpm: document.getElementById("finalCpm"),
          finalAccuracy: document.getElementById("finalAccuracy"),
          finalStreak: document.getElementById("finalStreak"),
          closeModalBtn: document.getElementById("closeModalBtn"),
          toast: document.getElementById("toast"),
          toastMessage: document.getElementById("toastMessage"),
          themeToggle: document.getElementById("themeToggle"),
          feedbackLink: document.getElementById("feedbackLink"),
        };

        // State
        const state = {
          timer: null,
          countdown: null,
          timeLeft: 0,
          totalTime: 0,
          currentIndex: 0,
          correctCount: 0,
          totalTyped: 0,
          streak: 0,
          maxStreak: 0,
          zenMode: false,
          running: false,
          startTime: null,
          lastScore: null,
          darkMode: window.matchMedia("(prefers-color-scheme: dark)").matches,
        };

        // Initialize
        function init() {
          setupEventListeners();
          resetAll();
          checkPreferredTheme();
        }

        // Event Listeners
        function setupEventListeners() {
          elements.startBtn.addEventListener("click", () => startTest(false));
          elements.zenBtn.addEventListener("click", () => startTest(true));
          elements.restartBtn.addEventListener("click", () =>
            startTest(state.zenMode)
          );
          elements.closeModalBtn.addEventListener("click", closeModal);
          elements.feedbackLink.addEventListener("click", showFeedbackToast);
          elements.themeToggle.addEventListener("click", toggleTheme);

          // Allow Enter key to start test if not running
          document.addEventListener("keydown", (e) => {
            if (e.key === "Enter" && !state.running && !state.zenMode) {
              startTest(false);
            }
          });
        }

        // Theme Management
        function checkPreferredTheme() {
          state.darkMode = window.matchMedia(
            "(prefers-color-scheme: dark)"
          ).matches;
          document.documentElement.classList.toggle(
            "light-theme",
            !state.darkMode
          );
        }

        function toggleTheme() {
          state.darkMode = !state.darkMode;
          document.documentElement.classList.toggle(
            "light-theme",
            !state.darkMode
          );

          // Update toggle icon
          const icon = elements.themeToggle.querySelector("svg");
          if (state.darkMode) {
            icon.innerHTML =
              '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />';
          } else {
            icon.innerHTML =
              '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />';
          }
        }

        // Generate random number strings with difficulty range
        function generateNumbers() {
          const minLen = parseInt(elements.difficultySelect.value);
          const maxLen = minLen + 2;
          let text = "";

          // Generate more groups for higher difficulty
          const groupCount = minLen <= 6 ? 50 : minLen <= 8 ? 60 : 70;

          for (let i = 0; i < groupCount; i++) {
            const groupLength =
              Math.floor(Math.random() * (maxLen - minLen + 1)) + minLen;
            let group = "";

            // Add some formatting for longer numbers
            if (groupLength > 8 && Math.random() > 0.7) {
              const part1 = Math.floor(Math.random() * 900 + 100); // 3 digits
              const part2 = Math.floor(Math.random() * 9000 + 1000); // 4 digits
              group = `${part1}-${part2}`;
            } else if (groupLength > 6 && Math.random() > 0.5) {
              const part1 = Math.floor(Math.random() * 90 + 10); // 2 digits
              const part2 = Math.floor(Math.random() * 900 + 100); // 3 digits
              group = `${part1} ${part2}`;
            } else {
              for (let j = 0; j < groupLength; j++) {
                group += Math.floor(Math.random() * 10);
              }
            }

            text += group + " ";
          }

          renderText(text.trim());
        }

        function renderText(text) {
          elements.textDisplay.innerHTML = "";
          text.split("").forEach((char, idx) => {
            const span = document.createElement("span");
            span.textContent = char;
            span.classList.add("char");
            if (idx === 0) span.classList.add("current");
            elements.textDisplay.appendChild(span);
          });
        }

        // Reset state and UI
        function resetAll() {
          clearInterval(state.timer);
          clearInterval(state.countdown);
          document.removeEventListener("keydown", handleTyping);
          elements.progressBar.style.width = "0%";
          elements.progressPercentage.textContent = "0%";

          elements.wpmEl.textContent = "0";
          elements.cpmEl.textContent = "0";
          elements.accuracyEl.textContent = "0";
          elements.streakEl.textContent = "0";
          elements.timeLeftEl.textContent = elements.timeInput.value || "60";

          state.streak = 0;
          state.maxStreak = 0;
          state.correctCount = 0;
          state.totalTyped = 0;
          state.currentIndex = 0;
          state.startTime = null;
          state.running = false;

          elements.startBtn.disabled = false;
          elements.zenBtn.disabled = false;
          elements.restartBtn.disabled = true;

          elements.textDisplay.innerHTML =
            "Press Start Test to begin your numeric typing challenge";
          elements.textDisplay.style.opacity = "1";
        }

        // Countdown before start
        function startCountdown(seconds = 3, callback) {
          let count = seconds;
          elements.textDisplay.textContent = `Test starts in ${count}...`;
          elements.textDisplay.style.opacity = "0.8";

          state.countdown = setInterval(() => {
            count--;
            if (count > 0) {
              elements.textDisplay.textContent = `Test starts in ${count}...`;
              showToast(`Test starting in ${count}...`, "info");
            } else {
              clearInterval(state.countdown);
              callback();
            }
          }, 1000);
        }

        // Start typing test
        function startTest(isZen = false) {
          resetAll();
          state.zenMode = isZen;
          state.totalTime = parseInt(elements.timeInput.value) || 60;

          elements.startBtn.disabled = true;
          elements.zenBtn.disabled = true;
          elements.restartBtn.disabled = false;

          // Countdown before actual test start
          startCountdown(3, () => {
            generateNumbers();
            state.running = true;
            state.startTime = performance.now();

            if (!state.zenMode) {
              // Normal timed mode
              state.timeLeft = state.totalTime;
              elements.timeLeftEl.textContent = state.timeLeft;
              state.timer = setInterval(updateTimer, 1000);
            } else {
              // Zen mode (infinite time)
              elements.timeLeftEl.textContent = "∞";
              showToast("Zen Mode Activated - No time limit", "success");
            }

            document.addEventListener("keydown", handleTyping);
            elements.textDisplay.focus();
            elements.textDisplay.style.opacity = "1";
          });
        }

        // Handle key presses
        function handleTyping(e) {
          if (!state.running) return;

          const chars = elements.textDisplay.querySelectorAll(".char");
          const currentChar = chars[state.currentIndex];
          if (!currentChar) return;

          if (e.key.length === 1) {
            // Only digits allowed (and space for formatted numbers)
            if (!/[\d\s-]/.test(e.key)) {
              showToast("Only numbers, spaces and hyphens allowed!", "error");
              return;
            }
            e.preventDefault();

            state.totalTyped++;

            if (e.key === currentChar.textContent) {
              currentChar.classList.add("correct");
              state.correctCount++;
              state.streak++;
              if (state.streak > state.maxStreak)
                state.maxStreak = state.streak;

              // Visual feedback for correct key
              if (state.streak % 10 === 0) {
                showToast(`🔥 Streak: ${state.streak}`, "success");
              }
            } else {
              currentChar.classList.add("wrong");
              state.streak = 0;
            }

            elements.streakEl.textContent = state.streak;
            elements.accuracyEl.textContent = (
              (state.correctCount / state.totalTyped) *
              100
            ).toFixed(1);
            currentChar.classList.remove("current");
            state.currentIndex++;

            if (chars[state.currentIndex]) {
              chars[state.currentIndex].classList.add("current");
              // Auto-scroll to keep current character visible
              chars[state.currentIndex].scrollIntoView({
                behavior: "smooth",
                block: "nearest",
                inline: "center",
              });
            } else {
              // Reached end of text
              if (state.zenMode) {
                generateNumbers();
                state.currentIndex = 0;
              } else {
                endTest();
              }
            }
            updateStats();
          } else if (e.key === "Backspace") {
            // Allow backspace to correct mistakes (but penalize in stats)
            e.preventDefault();
            if (state.currentIndex > 0) {
              const prevChar = chars[state.currentIndex - 1];
              prevChar.classList.remove("correct", "wrong", "current");
              state.currentIndex--;
              chars[state.currentIndex].classList.add("current");
              state.totalTyped++;
              state.streak = 0;
              elements.streakEl.textContent = state.streak;
            }
          }
        }

        // Update timer each second
        function updateTimer() {
          state.timeLeft--;
          elements.timeLeftEl.textContent = state.timeLeft;
          const progress =
            ((state.totalTime - state.timeLeft) / state.totalTime) * 100;
          elements.progressBar.style.width = progress + "%";
          elements.progressPercentage.textContent = Math.round(progress) + "%";

          if (state.timeLeft <= 10) {
            elements.progressBar.classList.add("pulse");
            if (state.timeLeft === 10) {
              showToast("10 seconds remaining!", "warning");
            }
          } else {
            elements.progressBar.classList.remove("pulse");
          }

          if (state.timeLeft <= 0) {
            endTest();
          }
        }

        // Update performance stats
        function updateStats() {
          const now = performance.now();
          const elapsedMs = now - state.startTime || 1;
          const elapsedMins = elapsedMs / 60000;

          // Calculate WPM (5 chars = 1 "word" for numbers)
          const wpm = (state.correctCount / 5 / elapsedMins).toFixed(1);
          const cpm = (state.correctCount / elapsedMins).toFixed(1);
          const accuracy = state.totalTyped
            ? ((state.correctCount / state.totalTyped) * 100).toFixed(1)
            : 0;

          elements.wpmEl.textContent = wpm;
          elements.cpmEl.textContent = cpm;
          elements.accuracyEl.textContent = accuracy;
        }

        // Show results modal
        function showResults() {
          elements.finalWpm.textContent = elements.wpmEl.textContent;
          elements.finalCpm.textContent = elements.cpmEl.textContent;
          elements.finalAccuracy.textContent = elements.accuracyEl.textContent;
          elements.finalStreak.textContent = state.maxStreak;

          // Save last score
          state.lastScore = {
            wpm: elements.wpmEl.textContent,
            cpm: elements.cpmEl.textContent,
            accuracy: elements.accuracyEl.textContent,
            streak: state.maxStreak,
            timestamp: new Date().toLocaleString(),
          };

          elements.resultModal.classList.add("active");
          elements.closeModalBtn.focus();
        }

        // Close modal
        function closeModal() {
          elements.resultModal.classList.remove("active");
          elements.textDisplay.focus();
          resetAll();
        }

        // End test and cleanup
        function endTest() {
          clearInterval(state.timer);
          clearInterval(state.countdown);
          document.removeEventListener("keydown", handleTyping);
          state.running = false;

          elements.startBtn.disabled = false;
          elements.zenBtn.disabled = false;
          elements.restartBtn.disabled = true;

          showResults();
        }

        // Toast notification
        function showToast(message, type = "info") {
          elements.toast.className = "toast";
          elements.toast.classList.add(`toast-${type}`);
          elements.toastMessage.textContent = message;

          // Set icon based on type
          const icon = elements.toast.querySelector(".toast-icon");
          icon.innerHTML = "";

          if (type === "success") {
            icon.innerHTML =
              '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>';
          } else if (type === "error") {
            icon.innerHTML =
              '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>';
          } else if (type === "warning") {
            icon.innerHTML =
              '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>';
          } else {
            icon.innerHTML =
              '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>';
          }

          elements.toast.classList.add("show");

          // Auto-hide after 3 seconds
          setTimeout(() => {
            elements.toast.classList.remove("show");
            elements.toast.classList.add("hide");

            setTimeout(() => {
              elements.toast.classList.remove("hide");
            }, 300);
          }, 3000);
        }

        // Feedback handler
        function showFeedbackToast(e) {
          e.preventDefault();
          showToast(
            "Thanks for your feedback! We'll improve the app.",
            "success"
          );
        }

        // Initialize the app
        init();
      })();
    </script>
  </body>
</html>
